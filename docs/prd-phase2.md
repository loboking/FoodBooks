# FoodBooks Phase 2 PRD
# 스마트 검색 (재료 기반), 영양정보 계산

---

## 1. 개요

### 1.1 프로젝트 목적
FoodBooks 레시피 관리 애플리케이션의 사용자 경험을 강화하기 위해 다음 2가지 기능을 구현:
1. 스마트 검색 (재료 기반 레시피 추천)
2. 영양정보 계산 (칼로리, 영양소)

### 1.2 대상 사용자
- 냉장고 털이 사용자: 가진 재료로 레시피 검색
- 건강 관리 사용자: 칼로리/영양소 확인

---

## 2. 기능 상세

### 2.1 스마트 검색 (재료 기반 레시피 추천)

#### 2.1.1 기능 설명
- 사용자가 가진 재료를 입력
- 해당 재료를 포함하는 레시피 추천
- 재료 매칭율에 따른 점수 계산
- 정확히 일치하는 재료수 / 필요 재료수

#### 2.1.2 사용자 시나리오
1. 레시피 페이지 진입
2. "스마트 검색" 버튼 클릭
3. 가진 재료 입력 (자동완성 지원)
4. 검색 실행
5. 매칭률 순서로 레시피 목록 표시

#### 2.1.3 기술 요건
- 레시피별 재료 매칭 알고리즘
- 자동완성 컴포넌트 (기존 재료 리스트 기반)
- 매칭 점수 계산 로직

#### 2.1.4 UI/UX 요건
- 스마트 검색 버튼 (레시피 페이지 상단)
- 재료 입력 필드 (쉼표로 구분 또는 태그 형식)
- 자동완성 드롭다운
- 매칭률 표시 (예: 3/5 재료 일치, 60%)
- 정렬 옵션: 매칭률, 인분, 난이도

#### 2.1.5 데이터베이스 스키마 변경
없음 (기존 ingredients 필드 활용)

#### 2.1.6 API 변경
- db.js에 새로운 메서드 추가:
  - `searchByIngredients(ingredientNames)` - 재료 기반 검색
  - `getAllIngredientNames()` - 모든 재료명 반환 (자동완성용)

---

### 2.2 영양정보 계산

#### 2.2.1 기능 설명
- 레시피별 칼로리 및 영양소 계산
- 인분에 따른 자동 계산
- 영양소: 칼로리, 탄수화물, 단백질, 지방, 나트륨

#### 2.2.2 사용자 시나리오
1. 레시피 작성/수정 시 영양정보 입력 (선택)
2. 레시피 상세에서 영양정보 표시
3. 인분 조절 시 영양정보 자동 계산
4. 쇼핑리스트에서 총 영양정보 표시

#### 2.2.3 기술 요건
- 영양정보 데이터 구조
- 인분별 영양정보 계산 로직
- 영양소 추천 섭취량 표시 (일일 권장량 대비)

#### 2.2.4 UI/UX 요건
- 레시피 상세: 영양정보 카드 (칼로리, 영양소 막대 그래프)
- 레시피 폼: 영양정보 입력 필드 (선택 사항)
- 쇼핑리스트: 총 영양정보 요약
- 일일 권장량 대비 퍼센트 표시

#### 2.2.5 데이터베이스 스키마 변경

**recipes objectStore에 추가 필드:**
```javascript
{
  nutrition: {
    calories: number,      // kcal (인분당)
    carbs: number,         // g
    protein: number,       // g
    fat: number,           // g
    sodium: number         // mg
  }
}
```

#### 2.2.6 API 변경
- db.js에 새로운 메서드 추가:
  - 없음 (기존 CRUD 활용)

---

## 3. 데이터베이스 마이그레이션

### 3.1 IndexedDB 버전 업그레이드
- 현재 버전: 3
- 새로운 버전: 4

### 3.2 마이그레이션 스크립트

```javascript
// db.js의 onupgradeneeded 핸들러에 추가
request.onupgradeneeded = (event) => {
    const db = event.target.result;

    // 기존 스토어 유지

    // recipes 스토어에 nutrition 필드 추가 (기본값 null)
    if (event.oldVersion < 4) {
        const recipeStore = event.target.transaction.objectStore('recipes');
        // nutrition 필드는 기존 데이터에는 null로 자동 초기화됨
    }
};
```

---

## 4. 구현 우선순위

### 4.1 Task 순서
1. **Task 1: 스마트 검색** (독립적, 사용자 가치 높음)
2. **Task 2: 영양정보 계산** (데이터 구조 필요)

### 4.2 각 Task 예상 소요 시간
- Task 1: 4-5시간
- Task 2: 3-4시간

---

## 5. 테스트 계획

### 5.1 단위 테스트
- 재료 매칭 알고리즘 정확도
- 영양정보 계산 정확도
- 자동완성 필터링

### 5.2 통합 테스트
- 스마트 검색 → 레시피 상세 → 영양정보 확인
- 레시피 작성 → 영양정보 입력 → 저장 → 상세 표시

### 5.3 사용자 테스트 시나리오
1. **시나리오 A: 냉장고 털이**
   - "김치, 돼지고기, 대파" 입력
   - 매칭률 높은 레시피 확인
   - 영양정보 확인

2. **시나리오 B: 레시피 작성**
   - 새 레시피 작성
   - 영양정보 입력
   - 저장 후 상세에서 영양정보 확인

3. **시나리오 C: 인분 조절**
   - 레시피 상세에서 인분 변경
   - 영양정보 자동 계산 확인

---

## 6. 리스크 및 완화 방안

### 6.1 스마트 검색
- **리스크**: 재료명 정규화 문제 (예: "계란" vs "달걀")
- **완화**: 재료명 사전/동의어 매핑 (Phase 3)

### 6.2 영양정보
- **리스크**: 영양정보 입력 번거로움
- **완화**: 선택 사항으로, 자동 추천 기능 (Phase 3)

---

## 7. 성공 지표

### 7.1 기술적 지표
- 스마트 검색 매칭 정확도 80% 이상
- 영양정보 계산 오차율 5% 미만

### 7.2 사용자 경험 지표
- 스마트 검색 사용률 20% 이상
- 영양정보 입력 완료율 30% 이상

---

## 8. 향후 확장 가능성

### 8.1 스마트 검색
- 재료명 정규화/동의어 매핑
- 식단 제약 필터 (채식, 저염, 당뇨 등)
- 영양소 기반 추천

### 8.2 영양정보
- 영양소 자동 계산 (재료별 영양 데이터베이스 연동)
- 일일 섭취량 추적
- 건강 목표 설정

---

## 9. 참고 문헌

- [IndexedDB API](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API)
- [대한민국 영양성분표](https://kfoodengdb.knsis.go.kr/)
